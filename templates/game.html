{% extends "layout.html" %}
{% block title %}Mercury{% endblock %}
{% block content %}
<script src="{{ url_for('static', filename='review_feedback.js') }}"></script>
<script src="{{ url_for('static', filename='timezone_handler.js') }}"></script>

    <h1 class="title">{{ game.title }}</h1>
    <p>
    <table class="table">
        <tr>
            <th>Genre:</th>
            <td>{{ game.genre }}</td>
        </tr>
        <tr>
            <th>Rating:</th>
            <td>{{ game.rating }}</td>
        </tr>
        <tr>
            <th>Votes:</th>
            <td>{{ game.votes }}</td>
        </tr>
        <tr>
            <th>Age Restriction:</th>
            <td>{{ game.age_restriction }}+</td>
        </tr>
        <tr>
            <th>Price:</th>
            <td>{{ game.price }}$</td>
        </tr>
    </table>
    </p>

    <form action="" method="post" name="item_list">
        <p>Items List:</p>
        <table class="table">
            <tr>
                <th>Item Picture:</th>
                <th>Item Name:</th>
                <th>Type:</th>
                <th>Rarity:</th>
                <th>Price:</th>
            </tr>
            {% for item in items %}
                <tr>
                    <td>
                        {% if current_user.is_admin %}
                            <label class="checkbox">
                                <input type="checkbox" name="item_ids" value="{{ item.item_id }}"/>
                            </label>
                        {% endif %}
                        <img src="{{images.url(item.picture)}}">
                    </td>
                    <td><a href="{{ url_for('item_purchase_page', game_id=game.game_id, item_id=item.item_id) }}">{{ item.name }}</a></td>
                    <td>{{ item.item_type }}</td>
                    <td>{{ item.rarity }}</td>
                    <td>{{ item.price }}</td>
                </tr>
            {% endfor %}
        </table>
        {% if current_user.is_admin %}
            <div class="field is-grouped">
                <div class="control">
                    <button class="button is-danger is-small">Delete items</button>
                </div>
            </div>
        {% endif %}
    </form>

    <p>Reviews</p>
    <ul>
        {% for review in reviews %}
            <li><div class="reviews">{{ review.label }}: {{ review.content }} (Likes: {{review.likes}}, Dislikes: {{review.dislikes}})(Submitted: <span class="timeobj">{{review.added.timestamp()*1000}}</span>{% if review.edited != None %}Last change: <span class="timeobj">{{review.edited.timestamp()*1000}}</span>{% endif %})
                <form id="like">
                    <button class="likes" id="{{review.id}}l" value="{{review.id}}" {% if review.disliked_from_current %} disabled {% endif %}>{% if review.liked_from_current %}You Liked It{% else %}Like{% endif %}</button>
                </form>
                <form id="dislike">
                    <button class="dislikes" id="{{review.id}}d" value="{{review.id}}" {% if review.liked_from_current %} disabled {% endif %}>{% if review.disliked_from_current %}You Disliked It{% else %}Dislike{% endif %}</button>
                </form>
                {% if review.user_id == current_user.id or current_user.is_admin%}
                <form action="{{url_for('delete_review', review_id=review.id)}}" method="POST">
                    <input type="hidden" name="review_id" value="{{review.id}}" />
                    <input type="hidden" name="game_id" value="{{game.game_id}}" />
                    <button>Delete review</button>
                </form>
                {% endif %}
            </div></li>
        {% endfor %}
    </ul>
    <p>Screenshots</p>
    <ul>
        {% for shot in screenshots %}
            <li><img src="{{images.url(shot.name)}}" alt="A Screenshot of {{game.title}}">Caption: {{shot.caption}}, (Added: <span class="timeobj">{{shot.date_added.timestamp()*1000}}</span>)
                <form id="like">
                    <button class="likes" id="{{shot.id}}l" value="{{shot.id}}" data-ent_type="SCREENSHOTS" {% if shot.disliked_from_current %} disabled {% endif %}>{% if shot.liked_from_current %}You Liked It{% else %}Like{% endif %}</button>
                </form>
                <form id="dislike">
                    <button class="dislikes" id="{{shot.id}}d" value="{{shot.id}}" data-ent_type="SCREENSHOTS" {% if shot.liked_from_current %} disabled {% endif %}>{% if shot.disliked_from_current %}You Disliked It{% else %}Dislike{% endif %}</button>
                </form>
                {% if shot.user_id == current_user.id or current_user.is_admin %}
                    <form action="{{url_for('delete_screenshot')}}" method="POST">
                        <input type="hidden" name="shot_name" value="{{shot.name}}">
                        <input type="hidden" name="game_id" value="{{game.game_id}}">
                        <button>Delete screenshot</button>
                    </form>
                {% endif %}
                <div>
                    <a href="{{ url_for('screenshot_comments_page', game_id=game.game_id, screenshot_id=shot.id) }}">View comments</a>
                </div>
            </li>
        {% endfor %}
    </ul>

    {% if current_user.is_authenticated %}
        <p><a href="{{ url_for('game_rate_page', game_id=game.game_id) }}">Rate the game</a></p>
        <p><a href="{{ url_for('game_purchase_page', game_id=game.game_id) }}">Purchase</a></p>
        <p><a href="{{ url_for('add_review', game_id=game.game_id) }}">Add review</a></p>
    {% endif %}
    <p><a href="{{ url_for('store_page') }}">Back</a></p>

    {% if current_user.is_admin %}
        <p><a href="{{ url_for('item_add_page', game_id=game.game_id) }}">Add item</a></p>
    {% endif %}
{% endblock %}
