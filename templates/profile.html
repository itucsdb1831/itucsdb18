{% extends "layout.html" %}
{% block title %}Mercury{% endblock %}
{% block content %}
    <script src="{{ url_for('static', filename='friend_request_feedback.js') }}"></script>
    <script src="{{ url_for('static', filename='game_favouriting_handler.js') }}"></script>

    <h1>{{ user.user_name }}</h1>
    <p>hello {{ user.user_name }}</p>

    {% if not current_user.is_admin %}
        <p>Your balance: {{ current_user.balance }}$</p>
    {% else %}
        <p>Your balance: :)</p>
    {% endif %}

    <h2>Library:</h2>
    {% if games_of_user %}
        <table class="table is-striped is-fullwidth">
            <th>Title</th>
            <th>Time Played</th>
            <th>Date Purchased</th>
            <th>Reviews</th>
            <th>Items</th>
            {% for game in games_of_user %}
                <tr id="{{ game.game_id }}">
                    <td><a href="{{ url_for('game_page', game_id=game.game_id) }}"> {{ game.title }} </a></td>
                    <td>{{ game.time_played }} hours</td>
                    <td>{{ game.time_purchased }}</td>
                    <td>{{ game.num_of_reviews }}</td>
                    <td>{{ game.num_of_items }}</td>
                    {% if game.is_favourite %}
                        <td id="column_favourite">*FAVOURITE*</td>
                        <td><button onclick="removeFromFavourites({{ current_user.id }}, {{ game.game_id }})">Unfavourite</button></td>
                    {% else %}
                        <td><button onclick="addToFavourites({{ current_user.id }}, {{ game.game_id }})">Favourite</button></td>
                    {% endif %}
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    <h3>Inventory:</h3>
    <table class="table is-striped is-fullwidth">
        <th>Name</th>
        <th>Level</th>
        <th>Color</th>
        <th>Equipped</th>
        <th>Favorite</th>
        <th>Date Purchased</th>
        {% for item in items_of_user %}
            <tr>
                <td>{{ item.name }}</td>
                <td>{{ item.level }}</td>
                <td>{{ item.color }}</td>
                <td>
                    {{ "+" if item.is_equipped else "-" }}
                </td>
                <td>
                    {{ "+" if item.is_favorite else "-" }}
                </td>
                <td>{{ item.date_purchased }}</td>
                <td><a href="{{ url_for("item_edit_page", item_id=item.item_id) }}">Edit item</a></td>
            </tr>
        {% endfor %}
    </table>

    <h4>Friends List:</h4>
    <table class="table is-striped is-fullwidth">
        {% for friend in friends %}
            <tr>
                <td>{{ friend.user2_name}}</td>
            </tr>
        {% endfor %}
    </table>
    <p><a href="{{ url_for('friend_add_page') }}"> Add a friend </a></p>

    {% if sent_friend_requests %}
        <P>You have sent friend requests to:</P>
            <ul>
                {% for sent_request in sent_friend_requests %}
                    <li id="{{ sent_request.user_id_to }}"><p> {{ sent_request.user_name_to }}
                            <button onclick="cancelRequest({{ sent_request.user_id_from }}, {{ sent_request.user_id_to }})">Cancel</button>
                    </p></li>
                {% endfor %}
            </ul>
    {% endif %}

    {% if received_friend_requests %}
        <p>You have new friend requests from:</p>
            <ul>
                {% for received_request in received_friend_requests %}
                    <li id="{{ received_request.user_id_from }}"><p> {{ received_request.user_name_from }}
                        <button onclick="acceptRequest({{ received_request.user_id_from }}, {{ received_request.user_id_to }})">Accept</button>
                        <button onclick="declineRequest({{ received_request.user_id_from }}, {{ received_request.user_id_to }})">Decline</button>
                    </p></li>
                {% endfor %}
            </ul>
    {% endif %}
{% endblock %}
